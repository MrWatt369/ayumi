<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Birthday Collection</title>
    <style>
        :root {
            --primary-red: #ff4757;
            --dark-red: #ca3e47;
            --gold: #ffa502;
            --bday-bg: linear-gradient(135deg, #fef9e7 0%, #f7d794 100%);
        }

        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Courier New', monospace;
            background: var(--bday-bg);
            transition: background 0.8s ease;
            touch-action: none;
        }

        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        #stage-1 {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: transform 1s cubic-bezier(0.7, 0, 0.3, 1), opacity 0.5s;
            z-index: 10;
        }

        #stage-2 {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            opacity: 0;
            pointer-events: none;
            transition: all 1s cubic-bezier(0.7, 0, 0.3, 1);
            z-index: 5;
        }

        #stage-3 {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transform: scale(1.2);
            transition: all 0.6s cubic-bezier(0.19, 1, 0.22, 1);
        }

        .envelope-wrapper {
            position: absolute;
            transform-style: preserve-3d;
            cursor: grab;
        }

        .env-base {
            position: relative;
            width: 100%;
            height: 100%;
            background-color: var(--dark-red);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }

        .flap {
            position: absolute;
            width: 0;
            height: 0;
            transition: transform 0.5s ease;
        }

        .main-env {
            width: 400px;
            height: 260px;
        }

        .main-env .top {
            border-left: 200px solid transparent;
            border-right: 200px solid transparent;
            border-top: 130px solid var(--primary-red);
            top: 0;
            transform-origin: top;
            z-index: 6;
        }

        .main-env .bottom {
            border-left: 200px solid transparent;
            border-right: 200px solid transparent;
            border-bottom: 130px solid var(--primary-red);
            bottom: 0;
            transform-origin: bottom;
            z-index: 5;
        }

        .main-env .left {
            border-top: 130px solid transparent;
            border-bottom: 130px solid transparent;
            border-left: 200px solid var(--primary-red);
            left: 0;
            transform-origin: left;
            z-index: 4;
        }

        .main-env .right {
            border-top: 130px solid transparent;
            border-bottom: 130px solid transparent;
            border-right: 200px solid var(--primary-red);
            right: 0;
            transform-origin: right;
            z-index: 4;
        }

        /* Star Env (Original Size: 210x135) */
        .star-env {
            width: 210px;
            height: 135px;
            top: calc(50% - 67px);
            left: calc(50% - 105px);
        }

        .star-env .top {
            border-left: 105px solid transparent;
            border-right: 105px solid transparent;
            border-top: 67px solid var(--primary-red);
            top: 0;
            transform-origin: top;
            z-index: 6;
        }

        .star-env .bottom {
            border-left: 105px solid transparent;
            border-right: 105px solid transparent;
            border-bottom: 67px solid var(--primary-red);
            bottom: 0;
            transform-origin: bottom;
            z-index: 5;
        }

        .star-env .left {
            border-top: 67px solid transparent;
            border-bottom: 67px solid transparent;
            border-left: 105px solid var(--primary-red);
            left: 0;
            transform-origin: left;
            z-index: 4;
        }

        .star-env .right {
            border-top: 67px solid transparent;
            border-bottom: 67px solid transparent;
            border-right: 105px solid var(--primary-red);
            right: 0;
            transform-origin: right;
            z-index: 4;
        }

        .seal {
            position: absolute;
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, var(--gold), #e67e22);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            pointer-events: none;
        }

        .open .top {
            transform: rotateX(180deg);
        }

        .open .bottom {
            transform: rotateX(-180deg);
        }

        .open .left {
            transform: rotateY(180deg);
        }

        .open .right {
            transform: rotateY(-180deg);
        }

        .open .seal {
            opacity: 0;
        }

        .stage-active {
            opacity: 1 !important;
            pointer-events: auto !important;
            transform: scale(1) !important;
        }

        .byers-room-active {
            opacity: 1 !important;
            pointer-events: auto !important;
            transform: none !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            background: transparent !important;
        }

        .stage-zoom {
            transform: scale(5) !important;
            opacity: 0 !important;
            pointer-events: none;
        }

        #backBtn {
            position: fixed;
            top: 30px;
            left: 30px;
            padding: 12px 25px;
            background: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            z-index: 3000;
            display: none;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            font-family: 'Courier New', monospace;
        }

        .msg-content {
            text-align: left;
            padding: 50px;
            border-radius: 30px;
            color: #333;
            max-width: 80%;
            background: white;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            position: relative;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        /* Paper with lines effect - ONLY for lined-paper class */
        .lined-paper {
            background: linear-gradient(to bottom, white 0%, white 98%);
            background-size: 100% 30px;
            background-position: 0 0;
            background-repeat: repeat;
        }

        .lined-paper::before {
            content: "";
            position: absolute;
            top: 0;
            left: 40px;
            right: 0;
            bottom: 0;
            width: 2px;
            background: repeating-linear-gradient(to bottom,
                    transparent,
                    transparent 28px,
                    #e0e0e0 28px,
                    #e0e0e0 30px);
        }

        .mission-header {
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #333;
        }

        .mission-header div {
            margin-bottom: 5px;
            font-weight: bold;
        }

        .signature {
            margin-top: 30px;
            font-style: italic;
            text-align: right;
            padding-right: 20px;
        }

        .start-label {
            color: #d35400;
            margin-top: 30px;
            letter-spacing: 5px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        /* Cake container styles */
        #cake-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 4000;
            display: none;
            pointer-events: none;
        }

        #cake-frame {
            width: 100%;
            height: 100%;
            border: none;
            pointer-events: none;
        }

        /* Glitch effect for the mission envelope */
        .mission-glitch {
            position: relative;
        }

        .mission-glitch::before,
        .mission-glitch::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .mission-glitch::before {
            animation: glitch-1 2s infinite linear alternate-reverse;
            left: 2px;
            text-shadow: -1px 0 red;
            clip: rect(24px, 550px, 90px, 0);
            opacity: 0.8;
        }

        .mission-glitch::after {
            animation: glitch-2 3s infinite linear alternate-reverse;
            left: -2px;
            text-shadow: -1px 0 blue;
            clip: rect(85px, 550px, 140px, 0);
            opacity: 0.8;
        }

        @keyframes glitch-1 {
            0% {
                clip: rect(20px, 550px, 80px, 0);
            }

            5% {
                clip: rect(32px, 550px, 120px, 0);
            }

            10% {
                clip: rect(10px, 550px, 75px, 0);
            }

            15% {
                clip: rect(85px, 550px, 140px, 0);
            }

            20% {
                clip: rect(65px, 550px, 110px, 0);
            }

            100% {
                clip: rect(90px, 550px, 150px, 0);
            }
        }

        @keyframes glitch-2 {
            0% {
                clip: rect(90px, 550px, 150px, 0);
            }

            5% {
                clip: rect(10px, 550px, 60px, 0);
            }

            10% {
                clip: rect(70px, 550px, 120px, 0);
            }

            15% {
                clip: rect(30px, 550px, 90px, 0);
            }

            20% {
                clip: rect(50px, 550px, 110px, 0);
            }

            100% {
                clip: rect(20px, 550px, 80px, 0);
            }
        }

        .birthday-video {
            width: 100%;
            max-width: 600px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-bottom: 25px;
            display: block;
        }

        .video-caption {
            font-family: cursive;
            font-size: 1.4rem;
            color: #333;
            text-align: center;
            margin-top: 15px;
            font-style: italic;
            padding: 10px 20px;
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 10px;
            display: inline-block;
        }

        /* Photo booth iframe styles */
        #photoBoothFrameContainer {
            position: relative;
        }

        #photoBoothFrameContainer::before {
            content: "LOADING PHOTO BOOTH...";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: rgba(255, 255, 255, 0.7);
            font-family: 'Courier New', monospace;
            z-index: 1;
        }

        #photoBoothFrameContainer iframe.loaded::before {
            display: none;
        }

        /* Make the iframe full screen button visible */
        #photoBoothFrameContainer iframe {
            background: rgba(0, 0, 0, 0.2);
        }

        /* Add to the existing style section */
        @keyframes fadeOut {
            0% {
                opacity: 1;
            }

            70% {
                opacity: 1;
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.9);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .prompt-item:hover {
            background: rgba(255, 255, 255, 0.1) !important;
            transform: translateY(-3px) !important;
        }

        /* Image sequence specific styles */
        .image-sequence-theme {
            background: #ffffff !important;
        }

        .image-sequence-theme .msg-content {
            background: #1e293b !important;
            color: #e2e8f0 !important;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3) !important;
            border: 1px solid #334155 !important;
        }

        .image-container {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            /* Added for bullet removal */
        }

        /* Remove bullet points/dots from image sequence */
        .image-container::before {
            display: none !important;
        }

        .sequence-image {
            max-width: 500px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            margin-bottom: 25px;
            transition: opacity 0.5s ease, transform 0.5s ease;
            /* Remove any bullet point styling */
            list-style-type: none !important;
        }

        /* Specifically remove any list styling */
        #imageSequenceContainer,
        #imageSequenceContainer div,
        #imageSequenceContainer img {
            list-style-type: none !important;
            margin-left: 0 !important;
            padding-left: 0 !important;
        }

        .sequence-btn {
            padding: 15px 40px;
            font-size: 1.2rem;
            background: #d1e7e0;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
            margin-top: 10px;
        }

        .sequence-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .go-back-btn {
            padding: 15px 40px;
            font-size: 1.2rem;
            background: linear-gradient(135deg, #ff0844 0%, #ffb199 100%);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255, 8, 68, 0.3);
            display: inline-block;
        }

        .go-back-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 8, 68, 0.4);
        }

        .hidden {
            display: none;
        }

        .fade-in {
            animation: fadeInUp 0.5s ease forwards;
        }

        /* Contract specific styles - FIXED FOR SCROLLING */
        .contract-theme {
            background: linear-gradient(135deg, #1a1a1a 0%, #333333 100%) !important;
        }

        .contract-theme .msg-content {
            background: #f4f4f4 !important;
            color: #000 !important;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3) !important;
            border: 1px solid #ccc !important;
            padding: 20px !important;
            /* Reduced padding */
            border-radius: 10px !important;
            max-width: 90% !important;
            max-height: 85vh !important;
            /* Limit height for scrolling */
            overflow-y: auto !important;
            /* Enable vertical scrolling */
            overflow-x: hidden !important;
            width: 90% !important;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            /* Align to top for scrolling */
        }

        /* Remove the lined paper effect from contract */
        .contract-theme .msg-content::before {
            display: none !important;
        }

        /* Contract page styles - FIXED SIZE */
        .contract-page {
            background-color: white !important;
            width: 100% !important;
            /* Changed from 8.5in to 100% */
            max-width: 800px !important;
            /* Maximum width */
            min-height: auto !important;
            /* Changed from 11in to auto */
            padding: 40px !important;
            /* Reduced padding */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1) !important;
            box-sizing: border-box !important;
            color: #000 !important;
            font-family: Arial, Helvetica, sans-serif !important;
            margin: 0 auto !important;
            overflow: visible !important;
        }

        .contract-page h1 {
            font-size: 32px !important;
            /* Reduced from 42px */
            margin: 0 !important;
            line-height: 1 !important;
            text-transform: uppercase !important;
            font-weight: 800 !important;
            letter-spacing: -1px !important;
        }

        .contract-page h2 {
            font-size: 28px !important;
            /* Reduced from 38px */
            margin: 5px 0 15px 0 !important;
            line-height: 1 !important;
            text-transform: uppercase !important;
            font-weight: 800 !important;
            letter-spacing: -1px !important;
        }

        .contract-page hr {
            border: 0 !important;
            border-top: 2px solid #000 !important;
            margin-bottom: 20px !important;
        }

        .contract-page .name-row {
            font-size: 16px !important;
            /* Reduced from 18px */
            margin-bottom: 20px !important;
            display: flex !important;
            align-items: baseline !important;
        }

        .contract-page .underline {
            flex-grow: 1 !important;
            border-bottom: 1px solid #000 !important;
            margin-left: 10px !important;
            min-width: 200px !important;
            /* Reduced from 300px */
        }

        .contract-page .intro-text {
            font-size: 15px !important;
            /* Reduced from 16px */
            margin-bottom: 20px !important;
        }

        .contract-page ol {
            padding-left: 20px !important;
            /* Reduced from 25px */
            margin: 0 !important;
        }

        .contract-page li {
            font-size: 14px !important;
            /* Reduced from 15.5px */
            line-height: 1.5 !important;
            /* Reduced from 1.6 */
            margin-bottom: 12px !important;
            /* Reduced from 18px */
            padding-left: 5px !important;
            /* Reduced from 10px */
        }

        /* Agree button styles */
        .contract-agree-btn {
            padding: 15px 30px !important;
            /* Reduced padding */
            font-size: 1.1rem !important;
            /* Reduced from 1.3rem */
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%) !important;
            color: white !important;
            border: none !important;
            border-radius: 5px !important;
            cursor: pointer !important;
            font-family: Arial, Helvetica, sans-serif !important;
            font-weight: bold !important;
            transition: all 0.3s ease !important;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3) !important;
            margin: 20px auto !important;
            /* Reduced from 30px */
            display: block !important;
            width: auto !important;
            max-width: 400px !important;
            /* Reduced from 500px */
        }

        .contract-agree-btn:hover {
            transform: translateY(-3px) !important;
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4) !important;
            background: linear-gradient(135deg, #45a049 0%, #4CAF50 100%) !important;
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .contract-page {
                padding: 20px !important;
            }

            .contract-page h1 {
                font-size: 26px !important;
            }

            .contract-page h2 {
                font-size: 22px !important;
            }

            .contract-page li {
                font-size: 13px !important;
            }

            .contract-agree-btn {
                padding: 12px 20px !important;
                font-size: 1rem !important;
            }
        }

        /* Scrollbar styling for contract */
        .contract-theme .msg-content::-webkit-scrollbar {
            width: 8px;
        }

        .contract-theme .msg-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .contract-theme .msg-content::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }

        .contract-theme .msg-content::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Byers Living Room specific styles */
        /* Byers Living Room specific styles - FIXED FOR FULL SCREEN */
        .byers-room-theme {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            max-width: 100% !important;
            max-height: 100% !important;
            margin: 0 !important;
            padding: 0 !important;
            background: transparent !important;
            box-shadow: none !important;
            border-radius: 0 !important;
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            overflow: hidden !important;
        }

        .byers-room-container {
            width: 100% !important;
            height: 100% !important;
            min-height: 100vh !important;
            overflow: hidden !important;
            background-color: #111 !important;
            position: relative !important;
            font-family: 'Courier New', monospace !important;
        }

        .bulb.active {
            transition: all 0.1s ease !important;
        }

        .bulb.blue.active {
            background: #008cff !important;
            box-shadow: 0 0 25px #008cff, 0 0 45px #008cff !important;
        }

        .bulb.yellow.active {
            background: #ffea00 !important;
            box-shadow: 0 0 25px #ffea00, 0 0 45px #ffea00 !important;
        }

        .bulb.red.active {
            background: #ff0000 !important;
            box-shadow: 0 0 25px #ff0000, 0 0 45px #ff0000 !important;
        }

        .bulb.green.active {
            background: #00ff15 !important;
            box-shadow: 0 0 25px #00ff15, 0 0 45px #00ff15 !important;
        }

        .bulb.purple.active {
            background: #bf00ff !important;
            box-shadow: 0 0 25px #bf00ff, 0 0 45px #bf00ff !important;
        }

        .bulb.flashing {
            animation: finalFlash 0.4s infinite !important;
        }

        @keyframes finalFlash {

            0%,
            100% {
                opacity: 0.3;
            }

            50% {
                opacity: 1;
                transform: scale(1.1);
            }
        }
    </style>
</head>

<body>

    <canvas id="confetti-canvas"></canvas>
    <button id="backBtn">‚Üê BACK TO DECK</button>
    <div id="cake-container"></div>

    <div id="stage-1">
        <div class="envelope-wrapper main-env" id="mainEnv">
            <div class="seal" style="width: 45px; height: 45px;"></div>
            <div class="env-base">
                <div class="flap top"></div>
                <div class="flap bottom"></div>
                <div class="flap left"></div>
                <div class="flap right"></div>
            </div>
        </div>
        <h2 class="start-label">TAP TO UNWRAP</h2>
    </div>

    <div id="stage-2"></div>

    <div id="stage-3">
        <div class="msg-content lined-paper" id="msgBody"></div>
    </div>

    <script>
        const themes = [
            {
                bg: "#111111",
                h: "Byers Living Room",
                p: `
        <div id="byersRoomContainer" class="byers-room-container">
            <div style="position: relative; width: 100%; height: 100vh; min-height: 100vh; display: flex; flex-direction: column; background: radial-gradient(circle at center, rgba(255,200,100,0.05) 0%, rgba(0,0,0,0.7) 100%);">
                <div style="flex: 1.5; background-color: #d2c1a5; background-image: radial-gradient(circle at 50% 50%, rgba(100,50,50,0.1) 10%, transparent 10.2%), radial-gradient(circle at 0% 0%, rgba(100,50,50,0.1) 10%, transparent 10.2%); background-size: 60px 80px; display: flex; flex-direction: column; justify-content: center; align-items: center; padding-top: 40px; border-bottom: 8px solid #22110a;">
                    <div class="alphabet-row" style="display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; position: relative;">
                        <div class="wire" style="position: absolute; top: 5px; width: 100%; height: 2px; background: #111; z-index: 0;"></div>
                        <div class="light-unit" style="display: flex; flex-direction: column; align-items: center; width: 50px;">
                            <div class="bulb blue" id="bulb-A" style="width: 14px; height: 22px; border-radius: 50% 50% 40% 40%; margin-bottom: 8px; background: rgba(40, 40, 40, 0.9); transition: all 0.1s ease;"></div>
                            <div class="letter" style="font-family: 'Courier New', monospace; font-size: 3rem; color: #1a1a1a; line-height: 1;">A</div>
                        </div>
                        <div class="light-unit" style="display: flex; flex-direction: column; align-items: center; width: 50px;">
                            <div class="bulb yellow" id="bulb-B" style="width: 14px; height: 22px; border-radius: 50% 50% 40% 40%; margin-bottom: 8px; background: rgba(40, 40, 40, 0.9); transition: all 0.1s ease;"></div>
                            <div class="letter" style="font-family: 'Courier New', monospace; font-size: 3rem; color: #1a1a1a; line-height: 1;">B</div>
                        </div>
                        <div class="light-unit" style="display: flex; flex-direction: column; align-items: center; width: 50px;">
                            <div class="bulb red" id="bulb-C" style="width: 14px; height: 22px; border-radius: 50% 50% 40% 40%; margin-bottom: 8px; background: rgba(40, 40, 40, 0.9); transition: all 0.1s ease;"></div>
                            <div class="letter" style="font-family: 'Courier New', monospace; font-size: 3rem; color: #1a1a1a; line-height: 1;">C</div>
                        </div>
                        <div class="light-unit" style="display: flex; flex-direction: column; align-items: center; width: 50px;">
                            <div class="bulb blue" id="bulb-D" style="width: 14px; height: 22px; border-radius: 50% 50% 40% 40%; margin-bottom: 8px; background: rgba(40, 40, 40, 0.9); transition: all 0.1s ease;"></div>
                            <div class="letter" style="font-family: 'Courier New', monospace; font-size: 3rem; color: #1a1a1a; line-height: 1;">D</div>
                        </div>
                        <div class="light-unit" style="display: flex; flex-direction: column; align-items: center; width: 50px;">
                            <div class="bulb green" id="bulb-E" style="width: 14px; height: 22px; border-radius: 50% 50% 40% 40%; margin-bottom: 8px; background: rgba(40, 40, 40, 0.9); transition: all 0.1s ease;"></div>
                            <div class="letter" style="font-family: 'Courier New', monospace; font-size: 3rem; color: #1a1a1a; line-height: 1;">E</div>
                        </div>
                        <div class="light-unit" style="display: flex; flex-direction: column; align-items: center; width: 50px;">
                            <div class="bulb yellow" id="bulb-F" style="width: 14px; height: 22px; border-radius: 50% 50% 40% 40%; margin-bottom: 8px; background: rgba(40, 40, 40, 0.9); transition: all 0.1s ease;"></div>
                            <div class="letter" style="font-family: 'Courier New', monospace; font-size: 3rem; color: #1a1a1a; line-height: 1;">F</div>
                        </div>
                        <div class="light-unit" style="display: flex; flex-direction: column; align-items: center; width: 50px;">
                            <div class="bulb purple" id="bulb-G" style="width: 14px; height: 22px; border-radius: 50% 50% 40% 40%; margin-bottom: 8px; background: rgba(40, 40, 40, 0.9); transition: all 0.1s ease;"></div>
                            <div class="letter" style="font-family: 'Courier New', monospace; font-size: 3rem; color: #1a1a1a; line-height: 1;">G</div>
                        </div>
                        <div class="light-unit" style="display: flex; flex-direction: column; align-items: center; width: 50px;">
                            <div class="bulb blue" id="bulb-H" style="width: 14px; height: 22px; border-radius: 50% 50% 40% 40%; margin-bottom: 8px; background: rgba(40, 40, 40, 0.9); transition: all 0.1s ease;"></div>
                            <div class="letter" style="font-family: 'Courier New', monospace; font-size: 3rem; color: #1a1a1a; line-height: 1;">H</div>
                        </div>
                    </div>
                    <div class="alphabet-row" style="display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; position: relative;">
                        <div class="wire" style="position: absolute; top: 5px; width: 100%; height: 2px; background: #111; z-index: 0;"></div>
                        <div class="light-unit" style="display: flex; flex-direction: column; align-items: center; width: 50px;">
                            <div class="bulb purple" id="bulb-I" style="width: 14px; height: 22px; border-radius: 50% 50% 40% 40%; margin-bottom: 8px; background: rgba(40, 40, 40, 0.9); transition: all 0.1s ease;"></div>
                            <div class="letter" style="font-family: 'Courier New', monospace; font-size: 3rem; color: #1a1a1a; line-height: 1;">I</div>
                        </div>
                        <div class="light-unit" style="display: flex; flex-direction: column; align-items: center; width: 50px;">
                            <div class="bulb yellow" id="bulb-J" style="width: 14px; height: 22px; border-radius: 50% 50% 40% 40%; margin-bottom: 8px; background: rgba(40, 40, 40, 0.9); transition: all 0.1s ease;"></div>
                            <div class="letter" style="font-family: 'Courier New', monospace; font-size: 3rem; color: #1a1a1a; line-height: 1;">J</div>
                        </div>
                        <div class="light-unit" style="display: flex; flex-direction: column; align-items: center; width: 50px;">
                            <div class="bulb blue" id="bulb-K" style="width: 14px; height: 22px; border-radius: 50% 50% 40% 40%; margin-bottom: 8px; background: rgba(40, 40, 40, 0.9); transition: all 0.1s ease;"></div>
                            <div class="letter" style="font-family: 'Courier New', monospace; font-size: 3rem; color: #1a1a1a; line-height: 1;">K</div>
                        </div>
                        <div class="light-unit" style="display: flex; flex-direction: column; align-items: center; width: 50px;">
                            <div class="bulb red" id="bulb-L" style="width: 14px; height: 22px; border-radius: 50% 50% 40% 40%; margin-bottom: 8px; background: rgba(40, 40, 40, 0.9); transition: all 0.1s ease;"></div>
                            <div class="letter" style="font-family: 'Courier New', monospace; font-size: 3rem; color: #1a1a1a; line-height: 1;">L</div>
                        </div>
                        <div class="light-unit" style="display: flex; flex-direction: column; align-items: center; width: 50px;">
                            <div class="bulb green" id="bulb-M" style="width: 14px; height: 22px; border-radius: 50% 50% 40% 40%; margin-bottom: 8px; background: rgba(40, 40, 40, 0.9); transition: all 0.1s ease;"></div>
                            <div class="letter" style="font-family: 'Courier New', monospace; font-size: 3rem; color: #1a1a1a; line-height: 1;">M</div>
                        </div>
                        <div class="light-unit" style="display: flex; flex-direction: column; align-items: center; width: 50px;">
                            <div class="bulb yellow" id="bulb-N" style="width: 14px; height: 22px; border-radius: 50% 50% 40% 40%; margin-bottom: 8px; background: rgba(40, 40, 40, 0.9); transition: all 0.1s ease;"></div>
                            <div class="letter" style="font-family: 'Courier New', monospace; font-size: 3rem; color: #1a1a1a; line-height: 1;">N</div>
                        </div>
                        <div class="light-unit" style="display: flex; flex-direction: column; align-items: center; width: 50px;">
                            <div class="bulb blue" id="bulb-O" style="width: 14px; height: 22px; border-radius: 50% 50% 40% 40%; margin-bottom: 8px; background: rgba(40, 40, 40, 0.9); transition: all 0.1s ease;"></div>
                            <div class="letter" style="font-family: 'Courier New', monospace; font-size: 3rem; color: #1a1a1a; line-height: 1;">O</div>
                        </div>
                        <div class="light-unit" style="display: flex; flex-direction: column; align-items: center; width: 50px;">
                            <div class="bulb purple" id="bulb-P" style="width: 14px; height: 22px; border-radius: 50% 50% 40% 40%; margin-bottom: 8px; background: rgba(40, 40, 40, 0.9); transition: all 0.1s ease;"></div>
                            <div class="letter" style="font-family: 'Courier New', monospace; font-size: 3rem; color: #1a1a1a; line-height: 1;">P</div>
                        </div>
                        <div class="light-unit" style="display: flex; flex-direction: column; align-items: center; width: 50px;">
                            <div class="bulb red" id="bulb-Q" style="width: 14px; height: 22px; border-radius: 50% 50% 40% 40%; margin-bottom: 8px; background: rgba(40, 40, 40, 0.9); transition: all 0.1s ease;"></div>
                            <div class="letter" style="font-family: 'Courier New', monospace; font-size: 3rem; color: #1a1a1a; line-height: 1;">Q</div>
                        </div>
                    </div>
                    <div class="alphabet-row" style="display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; position: relative;">
                        <div class="wire" style="position: absolute; top: 5px; width: 100%; height: 2px; background: #111; z-index: 0;"></div>
                        <div class="light-unit" style="display: flex; flex-direction: column; align-items: center; width: 50px;">
                            <div class="bulb red" id="bulb-R" style="width: 14px; height: 22px; border-radius: 50% 50% 40% 40%; margin-bottom: 8px; background: rgba(40, 40, 40, 0.9); transition: all 0.1s ease;"></div>
                            <div class="letter" style="font-family: 'Courier New', monospace; font-size: 3rem; color: #1a1a1a; line-height: 1;">R</div>
                        </div>
                        <div class="light-unit" style="display: flex; flex-direction: column; align-items: center; width: 50px;">
                            <div class="bulb green" id="bulb-S" style="width: 14px; height: 22px; border-radius: 50% 50% 40% 40%; margin-bottom: 8px; background: rgba(40, 40, 40, 0.9); transition: all 0.1s ease;"></div>
                            <div class="letter" style="font-family: 'Courier New', monospace; font-size: 3rem; color: #1a1a1a; line-height: 1;">S</div>
                        </div>
                        <div class="light-unit" style="display: flex; flex-direction: column; align-items: center; width: 50px;">
                            <div class="bulb blue" id="bulb-T" style="width: 14px; height: 22px; border-radius: 50% 50% 40% 40%; margin-bottom: 8px; background: rgba(40, 40, 40, 0.9); transition: all 0.1s ease;"></div>
                            <div class="letter" style="font-family: 'Courier New', monospace; font-size: 3rem; color: #1a1a1a; line-height: 1;">T</div>
                        </div>
                        <div class="light-unit" style="display: flex; flex-direction: column; align-items: center; width: 50px;">
                            <div class="bulb yellow" id="bulb-U" style="width: 14px; height: 22px; border-radius: 50% 50% 40% 40%; margin-bottom: 8px; background: rgba(40, 40, 40, 0.9); transition: all 0.1s ease;"></div>
                            <div class="letter" style="font-family: 'Courier New', monospace; font-size: 3rem; color: #1a1a1a; line-height: 1;">U</div>
                        </div>
                        <div class="light-unit" style="display: flex; flex-direction: column; align-items: center; width: 50px;">
                            <div class="bulb red" id="bulb-V" style="width: 14px; height: 22px; border-radius: 50% 50% 40% 40%; margin-bottom: 8px; background: rgba(40, 40, 40, 0.9); transition: all 0.1s ease;"></div>
                            <div class="letter" style="font-family: 'Courier New', monospace; font-size: 3rem; color: #1a1a1a; line-height: 1;">V</div>
                        </div>
                        <div class="light-unit" style="display: flex; flex-direction: column; align-items: center; width: 50px;">
                            <div class="bulb blue" id="bulb-W" style="width: 14px; height: 22px; border-radius: 50% 50% 40% 40%; margin-bottom: 8px; background: rgba(40, 40, 40, 0.9); transition: all 0.1s ease;"></div>
                            <div class="letter" style="font-family: 'Courier New', monospace; font-size: 3rem; color: #1a1a1a; line-height: 1;">W</div>
                        </div>
                        <div class="light-unit" style="display: flex; flex-direction: column; align-items: center; width: 50px;">
                            <div class="bulb yellow" id="bulb-X" style="width: 14px; height: 22px; border-radius: 50% 50% 40% 40%; margin-bottom: 8px; background: rgba(40, 40, 40, 0.9); transition: all 0.1s ease;"></div>
                            <div class="letter" style="font-family: 'Courier New', monospace; font-size: 3rem; color: #1a1a1a; line-height: 1;">X</div>
                        </div>
                        <div class="light-unit" style="display: flex; flex-direction: column; align-items: center; width: 50px;">
                            <div class="bulb red" id="bulb-Y" style="width: 14px; height: 22px; border-radius: 50% 50% 40% 40%; margin-bottom: 8px; background: rgba(40, 40, 40, 0.9); transition: all 0.1s ease;"></div>
                            <div class="letter" style="font-family: 'Courier New', monospace; font-size: 3rem; color: #1a1a1a; line-height: 1;">Y</div>
                        </div>
                        <div class="light-unit" style="display: flex; flex-direction: column; align-items: center; width: 50px;">
                            <div class="bulb blue" id="bulb-Z" style="width: 14px; height: 22px; border-radius: 50% 50% 40% 40%; margin-bottom: 8px; background: rgba(40, 40, 40, 0.9); transition: all 0.1s ease;"></div>
                            <div class="letter" style="font-family: 'Courier New', monospace; font-size: 3rem; color: #1a1a1a; line-height: 1;">Z</div>
                        </div>
                    </div>
                </div>
                <div style="flex: 1; background: #3a2218; background-image: linear-gradient(90deg, transparent 95%, rgba(0,0,0,0.4) 95%); background-size: 120px 100%; border-top: 15px solid #5d3a2a; box-shadow: inset 0 20px 30px rgba(0,0,0,0.5);"></div>
                <div class="couch" style="position: absolute; bottom: -20px; left: 50%; transform: translateX(-50%); width: 80%; height: 200px; background: repeating-linear-gradient(90deg, #d4a755, #d4a755 10px, #c29544 12px); border-radius: 50px 50px 0 0; box-shadow: 0 -10px 40px rgba(0,0,0,0.6); display: flex; justify-content: space-around; padding: 0 40px;">
                    <div class="couch-cushion" style="width: 30%; height: 80%; background: inherit; border: 2px solid rgba(0,0,0,0.1); border-radius: 20px 20px 0 0; margin-top: -10px;"></div>
                    <div class="couch-cushion" style="width: 30%; height: 80%; background: inherit; border: 2px solid rgba(0,0,0,0.1); border-radius: 20px 20px 0 0; margin-top: -10px;"></div>
                    <div class="couch-cushion" style="width: 30%; height: 80%; background: inherit; border: 2px solid rgba(0,0,0,0.1); border-radius: 20px 20px 0 0; margin-top: -10px;"></div>
                </div>
            </div>
            <div id="start-overlay" style="position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; z-index: 1000;">
                <button id="start-btn" style="padding: 15px 30px; font-family: 'Courier New', monospace; font-size: 1.5rem; background: #8b0000; color: white; border: none; cursor: pointer; border-radius: 5px;">Click to Message Ayumi</button>
            </div>
        </div>
    `,
                font: "'Courier New', monospace",
                isByersRoom: true
            },
            {
                bg: "linear-gradient(135deg, #1a1a1a 0%, #333333 100%)",
                h: "ACTORS/ACTRESS CONTRACT",
                p: `
                    <div class="contract-page">
                        <h1>ACTORS/ACTRESS</h1>
                        <h2>CONTRACT</h2>
                        <hr>

                        <div class="name-row">
                            Name: Ayumi
                        </div>

                        <p class="intro-text">As a member of the cast of the 'Stranger Things' Series :</p>

                        <ol>
                            <li>Steve Harrington will give you hair advice. You will take it. His hair has its own trailer, stylist, and earns more than both of us.</li>
                            <li>If you see a Demogorgon, your first move is to ask for a selfie. Then you scream. We need proof.</li>
                            <li>If Dustin sings, you must act like it's the best thing you've ever heard. Don't ask why.</li>
                            <li>There will be important filming moment which you will be asked to be silent and serious. This is when I will text you something funny or weird like a selfie with the Demogorgon working in a restaurant wearing a tiny hat. Do not laugh.</li>
                            <li>When filming ends each day, you will make free shawarma for the cast & crew. This is your real superpower.</li>
                            <li>You get paid in either regular money OR your favorite food for life. (The food is the better deal. Trust me).</li>
                            <li>When filming end each day, you MUST come eat shawarma with me. The only excuse is if you are actually dead-dead, not TV-dead.</li>
                            <li>Break any rule, and your punishment is to listen to Murray talk for 10 hours straight about something that makes no sense.</li>
                        </ol>
                        
                        <div style="margin-top: 30px; text-align: center;">
                            <button id="contractAgreeBtn" class="contract-agree-btn">
                                CLICK HERE TO SIGN AND AGREE TO THIS CHAOS
                            </button>
                        </div>
                        <div style="margin-top: 30px; padding-top: 15px; border-top: 1px solid #000;">
                            By signing below, I acknowledge that I have read and understood the terms of this contract and agree to BUY shawarma for Wlat after each filming day.
                        </div>
                    </div>
                `,
                font: "Arial, Helvetica, sans-serif"
            },
            {
                bg: "#ffe4e1",
                h: "IMAGE SEQUENCE",
                p: `
                    <div id="imageSequenceContainer" style="text-align: center;">
                        <div id="step1" class="image-container">
                            <img src="1.png" class="sequence-image" alt="Image 1">
                            <button id="btn1" class="sequence-btn">Hi</button>
                        </div>
                        <div id="step2" class="image-container hidden">
                            <img src="2.png" class="sequence-image" alt="Image 2">
                            <button id="btn2" class="sequence-btn">uhhhhh yes i kn her</button>
                        </div>
                        <div id="step3" class="image-container hidden">
                            <img src="3.png" class="sequence-image" alt="Image 3">
                            <button id="btn3" class="sequence-btn">YES THAT'S ME</button>
                        </div>
                        <div id="step4" class="image-container hidden">
                            <img src="4.png" class="sequence-image" alt="Image 4">
                            <button class="go-back-btn">Go Back</button>
                        </div>
                    </div>
                `,
                font: "'Courier New', monospace"
            },
            {
                bg: "#5c2224",
                h: "PHOTO BOOTH",
                p: `
        <div style="text-align: center; margin: 20px 0;">
            <div style="font-size: 1.2rem; margin-bottom: 20px; color: #fff; font-family: 'Courier New', monospace;">
                üì∏ Take 4 photos to create your collage!
            </div>
            <div id="photoBoothFrameContainer" style="width: 100%; height: 400px; border-radius: 15px; overflow: hidden; background: rgba(0,0,0,0.1); border: 3px solid rgba(255,255,255,0.2);">
                <!-- Iframe will be loaded here -->
            </div>
            <div style="margin-top: 20px; font-size: 0.9rem; color: rgba(255,255,255,0.8);">
                Camera will automatically stop when done
            </div>
        </div>
    `,
                font: "'Courier New', monospace"
            },
            {
                bg: "#333333",
                h: "Dreams",
                p: `
                    <video class="birthday-video" controls autoplay loop muted>
                        <source src="bday.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <div class="video-caption">The stars are just the beginning for you.</div>
                `,
                font: "cursive"
            },
            {
                bg: "linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%)",
                h: "MISSION BRIEFING",
                p: `<div class="mission-header">
                        <div>TO: The Problem</div>
                        <div>FROM: The Other Problem</div>
                        <div>RE: Your Birthday, Somehow.</div>
                    </div>
                    <div class="mission-glitch" data-text="Look who's surviving another trip around the sun. Congratulations on not dying for another year. Your mission is to navigate this weird website built for your birthday.">
                        Look who's surviving another trip around the sun. Congratulations on not dying for another year. Your mission is to navigate this weird website built for your birthday.
                    </div>
                    <br><br>
                    Try not to break it. Report back if you find a glitch. There's always a glitch for sure. Hopefully not this time.
                    <br><br>
                    <div class="signature">- Your Partner in Crime (The site might look bad but this all I could make be greatful and please accept my gift)</div>`,
                font: "'Courier New', monospace"
            }
        ];

        let thrownEnvelopes = new Set();
        let pusherTriggered = false;

        const stage1 = document.getElementById('stage-1');
        const stage2 = document.getElementById('stage-2');
        const stage3 = document.getElementById('stage-3');
        const mainEnv = document.getElementById('mainEnv');
        const backBtn = document.getElementById('backBtn');
        const cakeContainer = document.getElementById('cake-container');

        function initDeck() {
            themes.forEach((theme, i) => {
                const env = document.createElement('div');
                env.className = 'envelope-wrapper star-env';
                env.style.zIndex = 100 + i;
                env.style.transform = `rotate(180deg)`;

                // Make the mission envelope (6th one) look slightly different
                if (i === 5) {
                    env.style.boxShadow = '0 10px 25px rgba(0, 0, 0, 0.3), 0 0 15px rgba(0, 255, 255, 0.5)';
                }

                env.innerHTML = `<div class="seal"></div><div class="env-base"><div class="flap top"></div><div class="flap bottom"></div><div class="flap left"></div><div class="flap right"></div></div>`;
                setupUniversalDrag(env, theme, i);
                stage2.appendChild(env);
            });
        }

        function setupUniversalDrag(env, theme, index) {
            let startX, startY, velX = 0, velY = 0, lastX, lastY;
            let isDragging = false;

            const onStart = (e) => {
                if (env.classList.contains('open')) return;
                const point = e.touches ? e.touches[0] : e;
                startX = point.clientX; startY = point.clientY;
                lastX = startX; lastY = startY;
                env.style.transition = "none";
                env.style.zIndex = "1000";
            };

            const onMove = (e) => {
                if (!startX) return;
                isDragging = true;
                const point = e.touches ? e.touches[0] : e;
                const dx = point.clientX - lastX;
                const dy = point.clientY - lastY;
                velX = dx; velY = dy;
                env.style.left = (env.offsetLeft + dx) + "px";
                env.style.top = (env.offsetTop + dy) + "px";
                lastX = point.clientX; lastY = point.clientY;
            };

            const onEnd = () => {
                if (!startX) return;
                if (!isDragging) {
                    openStarEnv(env, theme);
                } else {
                    const speed = Math.sqrt(velX * velX + velY * velY);
                    if (speed > 3) {
                        thrownEnvelopes.add(index);
                        let tx = env.offsetLeft + (velX * 10);
                        let ty = env.offsetTop + (velY * 10);
                        tx = Math.max(-80, Math.min(window.innerWidth - 130, tx));
                        ty = Math.max(-50, Math.min(window.innerHeight - 80, ty));

                        env.style.transition = "all 0.6s cubic-bezier(0.23, 1, 0.32, 1)";
                        env.style.left = tx + "px";
                        env.style.top = ty + "px";
                        env.style.transform = `rotate(${(Math.random() - 0.5) * 60}deg)`;

                        if (thrownEnvelopes.size === themes.length && !pusherTriggered) {
                            pusherTriggered = true;
                            setTimeout(showBirthdayCake, 600);
                        }
                    }
                }
                startX = null;
                isDragging = false;
            };

            env.addEventListener('mousedown', onStart);
            window.addEventListener('mousemove', onMove);
            window.addEventListener('mouseup', onEnd);
            env.addEventListener('touchstart', onStart);
            window.addEventListener('touchmove', onMove);
            window.addEventListener('touchend', onEnd);
        }

        function openStarEnv(env, theme) {
            const rect = env.getBoundingClientRect();
            const mX = (window.innerWidth / 2) - (rect.left + rect.width / 2);
            const mY = (window.innerHeight / 2) - (rect.top + rect.height / 2);

            env.style.zIndex = "4000";
            env.style.transition = "all 0.8s cubic-bezier(0.7, 0, 0.3, 1)";
            env.style.transform = `translate(${mX}px, ${mY}px) rotate(0deg) scale(2.2)`;

            setTimeout(() => {
                env.classList.add('open');
                document.body.style.background = theme.bg;
                setTimeout(() => {
                    // Apply appropriate theme classes
                    if (theme.h === "IMAGE SEQUENCE") {
                        document.getElementById('msgBody').classList.add('image-sequence-theme');
                        document.getElementById('msgBody').classList.remove('contract-theme');
                        document.getElementById('msgBody').classList.remove('lined-paper');
                    } else if (theme.h === "ACTORS/ACTRESS CONTRACT") {
                        document.getElementById('msgBody').classList.add('contract-theme');
                        document.getElementById('msgBody').classList.remove('image-sequence-theme');
                        document.getElementById('msgBody').classList.remove('lined-paper');
                    } else if (theme.h === "Byers Living Room") {
                        document.getElementById('msgBody').classList.add('byers-room-theme');
                        document.getElementById('msgBody').classList.remove('lined-paper');
                        document.getElementById('msgBody').classList.remove('image-sequence-theme');
                        document.getElementById('msgBody').classList.remove('contract-theme');
                        // Make stage-3 full screen
                        stage3.classList.add('byers-room-active');
                        // Then setup
                        setTimeout(setupByersRoom, 100);
                    } else {
                        // Remove byers-room-active class if it was added
                        stage3.classList.remove('byers-room-active');
                        document.getElementById('msgBody').classList.remove('image-sequence-theme', 'contract-theme', 'byers-room-theme');
                        if (theme.h !== "MISSION BRIEFING") {
                            document.getElementById('msgBody').classList.add('lined-paper');
                        }
                    }

                    document.getElementById('msgBody').innerHTML =
                        theme.h === "MISSION BRIEFING"
                            ? `<h1 style="font-family: ${theme.font}; color: #333333; text-align: center; margin-top: 0;">${theme.h}</h1><div style="font-family: ${theme.font}">${theme.p}</div>`
                            : `<h1 style="font-family: ${theme.font}; color: #333333; text-align: center;">${theme.h}</h1><div style="font-family: ${theme.font}">${theme.p}</div>`;
                    stage2.classList.add('stage-zoom');
                    stage3.classList.add('stage-active');
                    backBtn.style.display = 'block';

                    // If this is the PHOTO BOOTH, load it
                    if (theme.h === "PHOTO BOOTH") {
                        loadPhotoBooth();
                    }
                    // If this is IMAGE SEQUENCE, setup the buttons
                    else if (theme.h === "IMAGE SEQUENCE") {
                        setupImageSequence();
                    }
                    // If this is CONTRACT, setup the agreement button
                    else if (theme.h === "ACTORS/ACTRESS CONTRACT") {
                        setupContract();
                    }
                    // If this is Byers Living Room, setup the interaction
                    else if (theme.h === "Byers Living Room") {
                        // Wait a bit for the DOM to be ready
                        setTimeout(setupByersRoom, 100);
                    }
                }, 800);
            }, 800);
        }

        // Show birthday cake function (replaces slideInBdayText)
        // Replace the showBirthdayCake function with this:
        function showBirthdayCake() {
            cakeContainer.innerHTML = '';
            cakeContainer.style.display = 'block';
            cakeContainer.style.position = 'fixed';
            cakeContainer.style.top = '50%';
            cakeContainer.style.left = '-600px'; // Start off-screen left
            cakeContainer.style.transform = 'translateY(-50%)';
            cakeContainer.style.zIndex = '4000';
            cakeContainer.style.width = 'auto';
            cakeContainer.style.height = 'auto';
            cakeContainer.style.background = 'transparent';
            cakeContainer.style.pointerEvents = 'none';
            cakeContainer.style.whiteSpace = 'nowrap';

            // Create iframe to load the cake
            const iframe = document.createElement('iframe');
            iframe.id = 'cake-frame';
            iframe.src = 'p.html';
            iframe.style.width = '800px';
            iframe.style.height = '600px';
            iframe.style.border = 'none';
            iframe.style.background = 'transparent';
            iframe.style.borderRadius = '20px';
            iframe.style.boxShadow = '0 15px 35px rgba(0,0,0,0.3)';

            cakeContainer.appendChild(iframe);

            // Slide in animation
            const targetLeft = (window.innerWidth / 2) - (400); // Center the cake
            let currentLeft = -600;

            const slideIn = () => {
                currentLeft += 12;
                cakeContainer.style.left = currentLeft + "px";

                // Push envelopes as the cake slides in (keep the original pushing effect)
                const cakeRect = {
                    left: currentLeft,
                    right: currentLeft + 800,
                    top: window.innerHeight / 2 - 300,
                    bottom: window.innerHeight / 2 + 300
                };

                document.querySelectorAll('.star-env').forEach(env => {
                    const eRect = env.getBoundingClientRect();
                    if (cakeRect.right > eRect.left && cakeRect.left < eRect.right &&
                        cakeRect.bottom > eRect.top && cakeRect.top < eRect.bottom) {
                        env.style.left = (env.offsetLeft + 15) + "px";
                    }
                });

                if (currentLeft < targetLeft) {
                    requestAnimationFrame(slideIn);
                } else {
                    // Launch confetti when cake reaches center
                    launchBirthdayConfetti();

                    // Make sure iframe is fully loaded and visible
                    setTimeout(() => {
                        iframe.style.pointerEvents = 'auto';
                    }, 500);
                }
            };

            requestAnimationFrame(slideIn);
        }

        // Keep the original launchBirthdayConfetti function
        function launchBirthdayConfetti() {
            const colors = ['#ff4757', '#ffa502', '#2ed573', '#1e90ff', '#ff6b81'];

            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.style.position = 'fixed';
                confetti.style.width = '12px';
                confetti.style.height = '12px';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.borderRadius = '50%';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = '-20px';
                confetti.style.zIndex = '3999';
                document.body.appendChild(confetti);

                // Animate confetti
                const duration = 2 + Math.random() * 3;
                const xMove = (Math.random() - 0.5) * 200;
                confetti.animate([
                    { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
                    { transform: `translateY(${window.innerHeight + 100}px) translateX(${xMove}px) rotate(${360 + Math.random() * 360}deg)`, opacity: 0 }
                ], {
                    duration: duration * 1000,
                    easing: 'cubic-bezier(0.215, 0.610, 0.355, 1)'
                });

                // Remove confetti after animation
                setTimeout(() => {
                    if (confetti.parentNode) {
                        confetti.parentNode.removeChild(confetti);
                    }
                }, duration * 1000);
            }
        }
        function pushEnvelopesAway() {
            let currentPos = -600;
            const targetPos = (window.innerWidth / 2);

            const step = () => {
                currentPos += 12;

                // Create a virtual pusher area
                const pusherArea = {
                    left: currentPos - 300,
                    right: currentPos + 300,
                    top: window.innerHeight / 2 - 50,
                    bottom: window.innerHeight / 2 + 50
                };

                document.querySelectorAll('.star-env').forEach(env => {
                    const envRect = env.getBoundingClientRect();
                    if (pusherArea.right > envRect.left && pusherArea.left < envRect.right &&
                        pusherArea.bottom > envRect.top && pusherArea.top < envRect.bottom) {
                        env.style.left = (env.offsetLeft + 15) + "px";
                    }
                });

                if (currentPos < targetPos) {
                    requestAnimationFrame(step);
                }
            };

            requestAnimationFrame(step);
        }

        // Setup Byers Room function
        // Setup Byers Room function - FIXED VERSION
        function setupByersRoom() {
            const startBtn = document.getElementById('start-btn');
            const overlay = document.getElementById('start-overlay');

            console.log('setupByersRoom called'); // Debug log

            if (!startBtn || !overlay) {
                console.log('Byers Room elements not found');
                return;
            }

            // Make sure the back button is accessible
            const backBtn = document.getElementById('backBtn');
            if (backBtn) {
                backBtn.style.zIndex = '2000'; // Higher than overlay
            }

            // Make overlay lower z-index than back button
            overlay.style.zIndex = '1000';

            // 1.5x Speed Timings
            const ON_TIME = 450;  // Time letter stays ON
            const OFF_TIME = 150; // Time between letters
            const SPACE_TIME = 500; // Pause for space between words

            async function sequenceMessage() {
                overlay.style.display = 'none';
                const msg = "HAPPY BIRTHDAY AYUMI WISH YOU A LONG LIFE FULL OF FUN AND UNFORGETTABLE ADVENTURES";

                console.log('Starting message sequence'); // Debug log

                for (let char of msg) {
                    if (char === " ") {
                        await new Promise(r => setTimeout(r, SPACE_TIME));
                        continue;
                    }

                    const bulb = document.getElementById('bulb-' + char);
                    if (bulb) {
                        bulb.classList.add('active');

                        await new Promise(r => setTimeout(r, ON_TIME));

                        bulb.classList.remove('active');
                        await new Promise(r => setTimeout(r, OFF_TIME));
                    }
                }

                // Finale: Turn all on and flash
                const allBulbs = document.querySelectorAll('.bulb');
                allBulbs.forEach(b => {
                    b.classList.add('active', 'flashing');
                });

                // Stop flashing after 4 seconds
                setTimeout(() => {
                    allBulbs.forEach(b => {
                        b.classList.remove('active', 'flashing');
                    });
                }, 4000);
            }

            startBtn.addEventListener('click', sequenceMessage);
            console.log('Event listener added to start button'); // Debug log
        }

        // Load photo booth function
        function loadPhotoBooth() {
            const container = document.getElementById('photoBoothFrameContainer');
            container.innerHTML = '';

            // Create iframe with sandbox to restrict permissions
            const iframe = document.createElement('iframe');
            iframe.id = 'photoBoothFrame';
            iframe.style.width = '100%';
            iframe.style.height = '100%';
            iframe.style.border = 'none';
            iframe.style.background = '#dcdcda';
            iframe.src = 'photo\\photo.html';

            // Listen for messages from iframe
            window.addEventListener('message', handlePhotoBoothMessage);

            container.appendChild(iframe);
        }

        // Handle messages from photo booth
        function handlePhotoBoothMessage(event) {
            // Check if message is from photo booth
            if (event.data && event.data.type === 'PHOTO_BOOTH_STATUS') {
                if (event.data.status === 'COMPLETED' || event.data.status === 'CLOSED') {
                    // Camera has been stopped by photo booth
                    console.log('Photo booth completed, camera stopped');
                }
            }
        }

        // Add this function to handle image sequence
        function setupImageSequence() {
            const btn1 = document.getElementById('btn1');
            const btn2 = document.getElementById('btn2');
            const btn3 = document.getElementById('btn3');
            const goBackBtn = document.querySelector('.go-back-btn');

            // Step 1 to Step 2
            if (btn1) {
                btn1.onclick = function () {
                    const step1 = document.getElementById('step1');
                    const step2 = document.getElementById('step2');

                    step1.style.opacity = "0";
                    setTimeout(() => {
                        step1.classList.add('hidden');
                        step2.classList.remove('hidden');
                        step2.classList.add('fade-in');
                    }, 300);
                };
            }

            // Step 2 to Step 3
            if (btn2) {
                btn2.onclick = function () {
                    const step2 = document.getElementById('step2');
                    const step3 = document.getElementById('step3');

                    step2.style.opacity = "0";
                    setTimeout(() => {
                        step2.classList.add('hidden');
                        step3.classList.remove('hidden');
                        step3.classList.add('fade-in');
                    }, 300);
                };
            }

            // Step 3 to Step 4
            if (btn3) {
                btn3.onclick = function () {
                    const step3 = document.getElementById('step3');
                    const step4 = document.getElementById('step4');

                    step3.style.opacity = "0";
                    setTimeout(() => {
                        step3.classList.add('hidden');
                        step4.classList.remove('hidden');
                        step4.classList.add('fade-in');
                    }, 300);
                };
            }

            // Go back button
            if (goBackBtn) {
                goBackBtn.onclick = function () {
                    backBtn.click();
                };
            }
        }

        // Add this function to handle contract agreement
        function setupContract() {
            const agreeBtn = document.getElementById('contractAgreeBtn');

            if (agreeBtn) {
                agreeBtn.onclick = function () {
                    // Show confirmation
                    alert("CONTRACT SIGNED! üìù\n\nWelcome to the cast of the 'Stranger Things' Series!\n\nYour commitment to the production has been noted.\n\nBreak a leg!");

                    // Change button text and style
                    agreeBtn.innerHTML = "‚úì CONTRACT SIGNED AND ACCEPTED";
                    agreeBtn.style.background = "linear-gradient(135deg, #666666 0%, #888888 100%)";
                    agreeBtn.style.cursor = "default";
                    agreeBtn.onclick = null; // Remove click handler

                    // Add some visual feedback
                    const contractPage = document.querySelector('.contract-page');
                    if (contractPage) {
                        contractPage.style.transition = "all 0.5s ease";
                        contractPage.style.boxShadow = "0 0 20px rgba(76, 175, 80, 0.5)";

                        setTimeout(() => {
                            contractPage.style.boxShadow = "0 0 10px rgba(0,0,0,0.1)";
                        }, 1000);
                    }

                    // Launch some confetti for celebration
                    launchContractConfetti();
                };
            }
        }

        // Function to launch confetti for contract acceptance
        function launchContractConfetti() {
            const colors = ['#4CAF50', '#2196F3', '#FF9800', '#9C27B0', '#F44336'];

            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.style.position = 'fixed';
                confetti.style.width = '10px';
                confetti.style.height = '10px';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.borderRadius = '50%';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = '-10px';
                confetti.style.zIndex = '9999';
                document.body.appendChild(confetti);

                // Animate confetti
                const duration = 2 + Math.random() * 3;
                confetti.animate([
                    { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
                    { transform: `translateY(${window.innerHeight + 100}px) rotate(${360 + Math.random() * 360}deg)`, opacity: 0 }
                ], {
                    duration: duration * 1000,
                    easing: 'cubic-bezier(0.215, 0.610, 0.355, 1)'
                });

                // Remove confetti after animation
                setTimeout(() => {
                    if (confetti.parentNode) {
                        confetti.parentNode.removeChild(confetti);
                    }
                }, duration * 1000);
            }
        }

        mainEnv.onclick = () => {
            mainEnv.classList.add('open');
            setTimeout(() => {
                stage1.classList.add('stage-zoom');
                stage2.classList.add('stage-active');
            }, 800);
        };

        backBtn.onclick = () => {
            // Stop camera in photo booth if it's open
            stopPhotoBoothCamera();

            document.body.style.background = "var(--bday-bg)";
            stage3.classList.remove('stage-active');
            stage3.classList.remove('byers-room-active'); // Add this line
            stage2.classList.remove('stage-zoom');
            backBtn.style.display = 'none';

            // Hide cake if visible
            cakeContainer.style.display = 'none';
            cakeContainer.innerHTML = '';

            document.querySelectorAll('.star-env').forEach(env => {
                env.classList.remove('open');
                // Force size back to original scale immediately
                env.style.transition = "all 0.4s ease";
                env.style.transform = `rotate(${(Math.random() - 0.5) * 30}deg) scale(1)`;
            });

            // Remove theme classes
            document.getElementById('msgBody').classList.remove('image-sequence-theme', 'contract-theme', 'byers-room-theme');
            // Add back lined-paper for default look
            document.getElementById('msgBody').classList.add('lined-paper');

            // Remove photo booth iframe and event listener
            const container = document.getElementById('photoBoothFrameContainer');
            if (container) container.innerHTML = '';
            window.removeEventListener('message', handlePhotoBoothMessage);
        };

        // Function to stop photo booth camera
        function stopPhotoBoothCamera() {
            const iframe = document.getElementById('photoBoothFrame');
            if (iframe && iframe.contentWindow) {
                // Send message to iframe to stop camera
                try {
                    iframe.contentWindow.postMessage({ type: 'STOP_CAMERA' }, '*');
                } catch (e) {
                    console.log('Could not send message to iframe');
                }
            }
        }

        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        let particles = [];
        for (let i = 0; i < 50; i++) particles.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, s: Math.random() * 4, v: Math.random() * 1 + 0.5, c: `hsl(${Math.random() * 360}, 70%, 80%)` });
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(p => { p.y += p.v; if (p.y > canvas.height) p.y = -10; ctx.fillStyle = p.c; ctx.fillRect(p.x, p.y, p.s, p.s); });
            requestAnimationFrame(animate);
        }
        animate();
        initDeck();
    </script>
</body>

</html>